---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";

interface Props {
    src: string;
    alt: string;
    dir: string;
}

const { src, alt, dir } = Astro.props;

// To be able to include images from non-public directory
let img_src = `/src/assets/images/${dir}/${src}`;

if (dir == "" || dir == "/") {
    img_src = `/src/assets/images/${src}`;
}

const images = import.meta.glob<{ default: ImageMetadata }>(
    "/src/assets/images/**/*.{jpg,jpeg,png}",
);
if (!images[img_src]) {
    throw new Error(`"${img_src}" not found in "/src/assets/images/${dir}/`);
}
---

<Image
    src={images[img_src]()}
    alt={alt}
    loading="lazy"
    widths={[240, 540, 720, 1300]}
    sizes={`(max-width: 639px) 240px, (max-width: 767px) 540px, (max-width: 1023px) 720px, 1300px`}
/>
